<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Опрос</title>
</head>
<body>
<h1 th:text="${survey.title}">Заголовок опроса</h1>
<p th:text="${survey.description}">Описание опроса</p>

<form id="survey-form" method="post" th:object="${survey}">
    <ol>
        <li th:each="question, questionIndex : ${survey.questions}">
            <p th:text="${question.questionText}">Вопрос</p>
            <ul>
                <li th:each="answer, answerIndex : ${question.answers}">
                    <input required
                           th:name="'question' + ${questionIndex}" th:value="${answer.id}"
                           type="radio"/>
                    <span th:text="${answer.answer}">Вариант ответа</span>
                </li>
            </ul>
        </li>
    </ol>
    <button type="submit">Отправить</button>
</form>

<script>
    document.getElementById('survey-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Отменяем стандартное поведение отправки формы

        // Создаем массив для хранения идентификаторов выбранных ответов
        var answerIds = [];

        // Перебираем все радиокнопки и собираем выбранные ответы
        var radioButtons = document.querySelectorAll('input[type="radio"]:checked');
        radioButtons.forEach(function(radio) {
            answerIds.push(radio.value); // Добавляем идентификатор ответа в массив
        });

        // Преобразуем массив идентификаторов в JSON
        var jsonData = JSON.stringify({ answerIds: answerIds });

        // Отправляем данные на сервер с помощью AJAX-запроса
        fetch('/survey', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: jsonData
        })
        .then(response => {
            if (response.ok) {
                alert('Ответы успешно отправлены!');
                window.location.replace("/registration");
            } else {
                alert('Произошла ошибка при отправке ответов.');
            }
        })
        .catch(error => {
            console.error('Ошибка при отправке данных:', error);
            alert('Произошла ошибка при отправке ответов.');
        });
    });
</script>

</body>
</html>